rtmp {
    server {
        listen <%=node['nginx']['rtmp']['rtmp_port']%>;
        <% 
        if node['nginx']['rtmp'].key?('publishers') then
          [*node['nginx']['rtmp']['publishers']].each do |p|
        %>
        allow publish <%=p%>;
        <%  end %>
        deny publish all;
        <% end %>
        chunk_size 4000;
        application live {
             live on;
             idle_streams off;
             <% if node['nginx']['rtmp']['hls'] then %>
             hls on;
             hls_path /tmp/hls;
             hls_fragment 5s;
             hls_playlist_length 60s;
             hls_sync 5ms;
             hls_type live;
             <% end %>
             <% if node['nginx']['rtmp']['dash'] then %>
             dash on;
             dash_path /tmp/dash;
             <% end %>
             allow play all;
       }
    }
}
